<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>URL Redirect Debug (Detailed Final URL)</title>
    <meta name="referrer" content="no-referrer">
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/encoding-japanese@2.0.0/encoding.min.js"></script>
    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const keywords_utf8_encoded_raw = urlParams.get('keywords');
            const baseUrl = urlParams.get('baseUrl');

            console.log("keywords_utf8_encoded_raw:", keywords_utf8_encoded_raw);
            console.log("baseUrl:", baseUrl);

            if (keywords_utf8_encoded_raw && baseUrl) {
                const keywords_utf8_encoded = encodeURIComponent(keywords_utf8_encoded_raw);
                console.log("keywords_utf8_encoded (after encodeURIComponent):", keywords_utf8_encoded);

                let keywords_utf16_decoded;
                try {
                    keywords_utf16_decoded = decodeURIComponent(keywords_utf8_encoded);
                    console.log("keywords_utf16_decoded (after decodeURIComponent):", keywords_utf16_decoded);
                } catch (e) {
                    console.error("decodeURIComponent() error:", e);
                    document.body.innerText = "Error: decodeURIComponent() failed.";
                    return;
                }


                Encoding.convert(keywords_utf16_decoded, {
                    to: 'EUCJP',
                    from: 'UTF8',
                    type: 'array'
                }, function(eucjp_bytes) {
                    console.log("eucjp_bytes (callback):", eucjp_bytes);

                    if (eucjp_bytes && eucjp_bytes.length > 0) {
                        let keywords_eucjp_encoded = '';
                        for (let i = 0; i < eucjp_bytes.length; i++) {
                            keywords_eucjp_encoded += '%' + eucjp_bytes[i].toString(16).toUpperCase();
                        }
                        console.log("keywords_eucjp_encoded:", keywords_eucjp_encoded); // 输出 EUC-JP 编码后的关键词

                        let finalUrl = baseUrl + '&keywords=' + keywords_eucjp_encoded;
                        console.log("finalUrl (before redirect):", finalUrl); // *输出 *完整的 finalUrl*  URL*
                        console.log("baseUrl (for finalUrl):", baseUrl); // *再次输出 *完整的 baseUrl*  URL*
                        console.log("keywords_eucjp_encoded (for finalUrl):", keywords_eucjp_encoded); // *再次输出 *完整的 keywords_eucjp_encoded*  URL*
                        console.log("window.location.href:", finalUrl);

                        window.location.href = finalUrl;
                    } else {
                        console.error("EUC-JP encoding failed, eucjp_bytes is empty or invalid.");
                        document.body.innerText = "Error: EUC-JP encoding failed.";
                    }
                });

            } else {
                document.body.innerText = "Error: Missing parameters.";
                console.error("Error: Missing parameters.");
                return;
            }
        })();
    </script>
</body>
</html>

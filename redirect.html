<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>URL Redirect (GitHub Pages)</title>
    <meta name="referrer" content="no-referrer">
</head>
<body>
    <script src="./encoding-japanese.min.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const baseUrl = urlParams.get('baseUrl');
    let keywords_utf8_encoded = urlParams.get('keywords');

    console.log("原始encoded keywords:", keywords_utf8_encoded);

    if (keywords_utf8_encoded && baseUrl) {
        // 修正1：双重解码URL编码
        const decodedKeywords = decodeURIComponent(decodeURIComponent(keywords_utf8_encoded));
        console.log("URL解码后的UTF-8字符串:", decodedKeywords);

        // 修正2：直接转换UNICODE字符串
        const eucjpBytes = Encoding.convert(decodedKeywords, {
            to: 'EUCJP',
            from: 'UNICODE', // 关键修改点
            type: 'string'
        });

        // 修正3：处理多字节编码
        const eucjpEncoded = Array.from(eucjpBytes)
            .map(b => '%' + b.toString(16).toUpperCase().padStart(2, '0'))
            .join('');
        
        console.log("EUC-JP编码结果:", eucjpEncoded);

        const finalUrl = `${baseUrl}${baseUrl.includes('?') ? '&' : '?'}keywords=${eucjpEncoded}`;
        window.location.href = finalUrl;
    }
</script>
</body>
</html>

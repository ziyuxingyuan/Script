<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>URL Redirect (GitHub Pages)</title>
    <meta name="referrer" content="no-referrer">
</head>
<body>
    <script src="./encoding-japanese.min.js"></script>
    <script>
    const urlParams = new URLSearchParams(window.location.search);
    const baseUrl = urlParams.get('baseUrl');
    let keywords_utf8_encoded = urlParams.get('keywords');

    console.log("原始encoded keywords:", keywords_utf8_encoded);

    if (keywords_utf8_encoded && baseUrl) {
        // 先解码URL编码（扩展传过来的参数是URL编码过的）
        const decodedKeywords = decodeURIComponent(keywords_utf8_encoded);
        console.log("URL解码后的UTF-8字符串:", decodedKeywords);

        // 将UTF-8字符串转换为EUC-JP字节数组
        const eucjpBytes = Encoding.convert(Encoding.stringToCode(decodedKeywords), {
            to: 'EUCJP',
            from: 'UTF8',
            type: 'array'
        });

        // 将字节数组转换为%XX形式
        const eucjpEncoded = eucjpBytes.map(b => '%' + b.toString(16).toUpperCase()).join('');
        console.log("EUC-JP编码结果:", eucjpEncoded);

        // 构造最终URL
        const finalUrl = `${baseUrl}${baseUrl.includes('?') ? '&' : '?'}keywords=${eucjpEncoded}`;
        console.log("最终跳转URL:", finalUrl);
        window.location.href = finalUrl;
    }
</script>
</body>
</html>
